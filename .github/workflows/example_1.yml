name: Check Tickets (Shell Only)
on:
  workflow_dispatch:
  schedule:
    - cron: '*/5 * * * *' # 5ë¶„ë§ˆë‹¤ ìë™ ì‹¤í–‰
jobs:
  job:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    env:
      PRODUCT_ID: 211782
      SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
    steps:
    # -------------------------------------------------------------
    # 1ì¼ì°¨ ê³µì—° (schedule-id: 100001) ê°ì‹œ ì‹œì‘
    # -------------------------------------------------------------

    # 1. ğŸ¥‡ 1ì¼ì°¨ VIP ë“±ê¸‰ ê°ì‹œ
    - name: Check Tickets - VIP ë“±ê¸‰ (1ì¼ì°¨)
      run: |
        # API í˜¸ì¶œ ë° ì”ì—¬ì„ í™•ì¸ (API ì‘ë‹µì— "success":trueê°€ í¬í•¨ë˜ë©´ ì”ì—¬ì„ ìˆë‹¤ê³  ê°€ì •)
        RESPONSE=$(curl -s "https://ticket.melon.com/api/web/product/schedule.json?pId=${{ env.PRODUCT_ID }}&sId=100001&seatId=10000")
        
        if echo "$RESPONSE" | grep -q '"success":true'; then
          echo "VIP ì¢Œì„ (1ì¼ì°¨) ì”ì—¬ì„ ë°œê²¬! ìŠ¬ë™ ì•Œë¦¼ ì „ì†¡."
          curl -X POST -H 'Content-type: application/json' --data '{"text":"ğŸ“¢ VIP ì¢Œì„ í’€ë ¸ìŠµë‹ˆë‹¤! (1ì¼ì°¨) ì¦‰ì‹œ êµ¬ë§¤í•˜ì„¸ìš”!!\në§í¬: https://ticket.melon.com/performance/index.htm?prodId=${{ env.PRODUCT_ID }}"}' ${{ env.SLACK_WEBHOOK_URL }}
        else
          echo "VIP ì¢Œì„ (1ì¼ì°¨) ì”ì—¬ì„ ì—†ìŒ."
        fi

    # 2. ğŸ¥ˆ 1ì¼ì°¨ R ë“±ê¸‰ ê°ì‹œ
    - name: Check Tickets - R ë“±ê¸‰ (1ì¼ì°¨)
      run: |
        RESPONSE=$(curl -s "https://ticket.melon.com/api/web/product/schedule.json?pId=${{ env.PRODUCT_ID }}&sId=100001&seatId=10008")
        if echo "$RESPONSE" | grep -q '"success":true'; then
          echo "R ë“±ê¸‰ (1ì¼ì°¨) ì”ì—¬ì„ ë°œê²¬! ìŠ¬ë™ ì•Œë¦¼ ì „ì†¡."
          curl -X POST -H 'Content-type: application/json' --data '{"text":"ğŸ“¢ ì¼ë°˜ì„ í’€ë ¸ìŠµë‹ˆë‹¤! (1ì¼ì°¨) ì¦‰ì‹œ êµ¬ë§¤í•˜ì„¸ìš”!!\në§í¬: https://ticket.melon.com/performance/index.htm?prodId=${{ env.PRODUCT_ID }}"}' ${{ env.SLACK_WEBHOOK_URL }}
        else
          echo "R ë“±ê¸‰ (1ì¼ì°¨) ì”ì—¬ì„ ì—†ìŒ."
        fi

    # 3. ğŸ¥‰ 1ì¼ì°¨ S ë“±ê¸‰ ê°ì‹œ
    - name: Check Tickets - S ë“±ê¸‰ (1ì¼ì°¨)
      run: |
        RESPONSE=$(curl -s "https://ticket.melon.com/api/web/product/schedule.json?pId=${{ env.PRODUCT_ID }}&sId=100001&seatId=12051")
        if echo "$RESPONSE" | grep -q '"success":true'; then
          echo "S ë“±ê¸‰ (1ì¼ì°¨) ì”ì—¬ì„ ë°œê²¬! ìŠ¬ë™ ì•Œë¦¼ ì „ì†¡."
          curl -X POST -H 'Content-type: application/json' --data '{"text":"ğŸ“¢ ì‹œì œì„ í’€ë ¸ìŠµë‹ˆë‹¤! (1ì¼ì°¨) ì¦‰ì‹œ êµ¬ë§¤í•˜ì„¸ìš”!!\në§í¬: https://ticket.melon.com/performance/index.htm?prodId=${{ env.PRODUCT_ID }}"}' ${{ env.SLACK_WEBHOOK_URL }}
        else
          echo "S ë“±ê¸‰ (1ì¼ì°¨) ì”ì—¬ì„ ì—†ìŒ."
        fi

    # -------------------------------------------------------------
    # 2ì¼ì°¨ ê³µì—° (schedule-id: 100002) ê°ì‹œ ì‹œì‘
    # -------------------------------------------------------------

    # 4. ğŸ¥‡ 2ì¼ì°¨ VIP ë“±ê¸‰ ê°ì‹œ
    - name: Check Tickets - VIP ë“±ê¸‰ (2ì¼ì°¨)
      run: |
        RESPONSE=$(curl -s "https://ticket.melon.com/api/web/product/schedule.json?pId=${{ env.PRODUCT_ID }}&sId=100002&seatId=10000")
        if echo "$RESPONSE" | grep -q '"success":true'; then
          echo "VIP ì¢Œì„ (2ì¼ì°¨) ì”ì—¬ì„ ë°œê²¬! ìŠ¬ë™ ì•Œë¦¼ ì „ì†¡."
          curl -X POST -H 'Content-type: application/json' --data '{"text":"ğŸ“¢ VIP ì¢Œì„ í’€ë ¸ìŠµë‹ˆë‹¤! (2ì¼ì°¨) ì¦‰ì‹œ êµ¬ë§¤í•˜ì„¸ìš”!!\në§í¬: https://ticket.melon.com/performance/index.htm?prodId=${{ env.PRODUCT_ID }}"}' ${{ env.SLACK_WEBHOOK_URL }}
        else
          echo "VIP ì¢Œì„ (2ì¼ì°¨) ì”ì—¬ì„ ì—†ìŒ."
        fi

    # 5. ğŸ¥ˆ 2ì¼ì°¨ R ë“±ê¸‰ ê°ì‹œ
    - name: Check Tickets - R ë“±ê¸‰ (2ì¼ì°¨)
      run: |
        RESPONSE=$(curl -s "https://ticket.melon.com/api/web/product/schedule.json?pId=${{ env.PRODUCT_ID }}&sId=100002&seatId=10008")
        if echo "$RESPONSE" | grep -q '"success":true'; then
          echo "R ë“±ê¸‰ (2ì¼ì°¨) ì”ì—¬ì„ ë°œê²¬! ìŠ¬ë™ ì•Œë¦¼ ì „ì†¡."
          curl -X POST -H 'Content-type: application/json' --data '{"text":"ğŸ“¢ ì¼ë°˜ì„ í’€ë ¸ìŠµë‹ˆë‹¤! (2ì¼ì°¨) ì¦‰ì‹œ êµ¬ë§¤í•˜ì„¸ìš”!!\në§í¬: https://ticket.melon.com/performance/index.htm?prodId=${{ env.PRODUCT_ID }}"}' ${{ env.SLACK_WEBHOOK_URL }}
        else
          echo "R ë“±ê¸‰ (2ì¼ì°¨) ì”ì—¬ì„ ì—†ìŒ."
        fi

    # 6. ğŸ¥‰ 2ì¼ì°¨ S ë“±ê¸‰ ê°ì‹œ
    - name: Check Tickets - S ë“±ê¸‰ (2ì¼ì°¨)
      run: |
        RESPONSE=$(curl -s "https://ticket.melon.com/api/web/product/schedule.json?pId=${{ env.PRODUCT_ID }}&sId=100002&seatId=12051")
        if echo "$RESPONSE" | grep -q '"success":true'; then
          echo "S ë“±ê¸‰ (2ì¼ì°¨) ì”ì—¬ì„ ë°œê²¬! ìŠ¬ë™ ì•Œë¦¼ ì „ì†¡."
          curl -X POST -H 'Content-type: application/json' --data '{"text":"ğŸ“¢ ì‹œì œì„ í’€ë ¸ìŠµë‹ˆë‹¤! (2ì¼ì°¨) ì¦‰ì‹œ êµ¬ë§¤í•˜ì„¸ìš”!!\në§í¬: https://ticket.melon.com/performance/index.htm?prodId=${{ env.PRODUCT_ID }}"}' ${{ env.SLACK_WEBHOOK_URL }}
        else
          echo "S ë“±ê¸‰ (2ì¼ì°¨) ì”ì—¬ì„ ì—†ìŒ."
        fi
